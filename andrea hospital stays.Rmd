---
title: "andrea hospital stays"
author: "Andrea"
date: "2023-06-16"
output: html_document
---

```{r}
data_analytics <- read_csv('data/raw/analytic_data2023_0.csv', skip = 1)
```

```{r}
# Script to create variable description
#
# The original data has two rows:
# 1. the long description and 2. the encoded name
# Output is 1 row dataframe of desc (row1) with column names (row2)
library(tidyverse)
desc = colnames(read_csv("data/raw/analytic_data2023_0.csv", n_max=1))
enc = colnames(read_csv("data/raw/analytic_data2023_0.csv", skip=1, n_max=1))

descriptions = data.frame(t(desc))
colnames(descriptions) = enc
row.names(descriptions) = "description"
saveRDS(descriptions, "data/processed/colDesc_analysis2023.rds")

# Use case
descriptions %>% select(starts_with("v005_rawvalue"))
#                                   v005_rawvalue
#description Preventable Hospital Stays raw value
```
```{r}
data_analytics %>% ggplot( aes(x=v023_rawvalue, y=v005_rawvalue))+
  geom_point(color = ifelse(data_analytics$state =="CA", 'black', 'pink'), alpha=0.3)
  
```

```
#Above is xaxis preventable hospital stays and yaxis unemployment raw rate
```

```{r}
data_analytics %>% ggplot(aes(x=v005_rawvalue, y=v168_rawvalue))+
  geom_point(color = ifelse(data_analytics$state =="CA", 'red', 'blue'), alpha=0.3) +
  labs(x = "Preventable Hospital Stays", y= "High School Completion")
```
#Above only raw data specified.


































#Preventable Hospital Stays-Asian - High School Completion:

```{r}
data_analytics %>% ggplot(aes(x=v168_rawvalue, y=v005_race_asian))+
  geom_point (alpha=0.9) +
  labs(x = "High School Completion", y= "Preventable Hospital Stays(Asian)")
```












#Below Prevetable Hospital Stays (Black) - High School Completion:
```{r}
data_analytics %>% ggplot(aes(x=v168_rawvalue, y=v005_race_black))+
  geom_point (alpha=0.9) +
  labs(x = "High School Completion", y= "Preventable Hospital Stays(Black)")
```











#Below are Preventable Hospital Stays (Hispanics) - High School Completion:



```{r}
data_analytics %>% ggplot(aes(x=v168_rawvalue, y=v005_race_hispanic))+
  geom_point (alpha=0.9) +
  labs(x = "High School Completion", y= "Preventable Hospital Stays(Hispanic)")
```








#Below are Preventable hospital stays(White) - High School Completion
```{r}
data_analytics %>% ggplot(aes(x=v168_rawvalue, y=v005_race_white))+
  geom_point (alpha=0.9) +
  labs(x = "High School Completion", y= "Preventable Hospital Stays(White)")
```












#Below are Preventable Hospital Stays(American Indian/Alaska Native) - High School Completion
```{r}
data_analytics %>% ggplot(aes(x=v168_rawvalue, y=v005_race_aian))+
  geom_point (alpha=0.9) +
  labs(x = "High School Completion", y= "Preventable Hospital Stays(American Indian/Alaska Native)")
```


```{r}
install.packages("reshape2")
```



#melted data

```{r}
library(reshape2)
library(reshape2)
library(dplyr)
data_HSC = data_analytics[ , c("state","county","v005_race_asian","v005_race_black","v005_race_hispanic", "v005_race_white","v005_race_aian")]


ndimdf_preventable = melt(data_HSC, id = c("state", "county"),variable.name='race') #this melts the county and state instead of the others
```

```{r}
library(tidyverse)
#plots for y axis by race

#gather all y axis colnames - i.e. preventable hospital stays by race 
#our x axis will be the same, income inequality v044_rawvalue
plot_var_names_list <- data_analytics %>% select(starts_with('v005_race')) %>% colnames

# Loop over the list of variable names
for (y_var in plot_var_names_list) {
  # Generate the plot
  p <- ggplot(data_analytics, aes_string(x = "v168_rawvalue", y = y_var)) +
    geom_point(alpha = 0.3) +
    labs(x = descriptions[["v168_rawvalue"]], y = descriptions[[y_var]]) +
    theme_minimal()
  
  # Print the plot
  print(p)
}

```



#Comparison between all races 
```{r}
library(tidyverse)

data_long <- data_analytics %>%
  pivot_longer(cols = starts_with('v005_race'), names_to = "race", values_to = "value")



p <- ggplot(data_long, aes(x = v168_rawvalue, y = value, color = race)) +
  geom_point(alpha = 0.8) +
  labs(x = descriptions[["v168_rawvalue"]], y = "Preventable Hospital Stays") +
  scale_color_discrete(labels = c("Asian", "AIAN", "Black", "Hispanic", "White")) +
  theme(
    plot.background = element_rect(fill = "black"),
    panel.background = element_rect(fill = "black"),
    axis.title = element_text(color = "white"),
    axis.text = element_text(color = "white"),
    legend.background = element_rect(fill = "black"),
    legend.text = element_text(color = "white")
  )

  print(p)
```







